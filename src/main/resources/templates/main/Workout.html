<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{components/Header :: header('Fitconnect')}"></head>
<body>
<div th:replace="~{components/Navigation :: navbar}"></div>
<div class="container">
    <h2>Workout</h2>
    <form method="post" id="workoutForm">
        <div class="form-group">
            <label for="workoutName">Select Workout:</label>
            <select class="form-control" id="workoutName" name="nameOfWorkout">
                <option value="" selected disabled>Select a Workout</option>
                <option value="Bench Press">Bench Press</option>
                <option value="Deadlift">Deadlift</option>
                <option value="Squat">Squat</option>
                <!-- Add more common workouts as needed -->
            </select>
        </div>
        <table class="table" id="workoutTable">
            <thead>
            <tr>
                <th>Sets</th>
                <th>Reps</th>
                <th>Weight</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>1</td>
                <td><input type="number" class="form-control" name="reps[]" required></td>
                <td><input type="number" class="form-control" name="weight[]" required></td>
                <td><button type="button" class="btn btn-danger" onclick="deleteRow(this)">X</button></td>
            </tr>
            <!-- Additional rows will be added dynamically -->
            </tbody>
        </table>
        <button type="button" class="btn btn-primary" onclick="addRow()">Add Row</button>
        <button type="submit" class="btn btn-success">Create Workout</button>
        <button type="button" class="btn btn-success" onclick="submitWorkout()">Save</button>
    </form>

</div>

<script>
    /* Function to add a new row to the table */
    function addRow() {
        var table = document.getElementById("workoutTable").getElementsByTagName('tbody')[0];
        var newRow = table.insertRow(table.rows.length);

        var setNumber = table.rows.length;
        var cells = newRow.insertCell(0);
        cells.appendChild(document.createTextNode(setNumber));

        cells = newRow.insertCell(1);
        var repsInput = document.createElement("input");
        repsInput.setAttribute("type", "number");
        repsInput.setAttribute("class", "form-control");
        repsInput.setAttribute("name", "reps[]");
        repsInput.required = true;
        cells.appendChild(repsInput);

        cells = newRow.insertCell(2);
        var weightInput = document.createElement("input");
        weightInput.setAttribute("type", "number");
        weightInput.setAttribute("class", "form-control");
        weightInput.setAttribute("name", "weight[]");
        weightInput.required = true;
        cells.appendChild(weightInput);

        cells = newRow.insertCell(3);
        var deleteButton = document.createElement("button");
        deleteButton.innerHTML = "X"; // 'X' icon for delete
        deleteButton.setAttribute("type", "button");
        deleteButton.setAttribute("class", "btn btn-danger");
        deleteButton.onclick = function() {
            // Remove the row when delete button is clicked
            table.deleteRow(newRow.rowIndex-1);
        };
        cells.appendChild(deleteButton);
    }

    /* Function to gather data and submit the form */
    function submitWorkout() {
    var workoutName = document.getElementById("workoutName").value;

    var table = document.getElementById("workoutTable");
    var rows = table.getElementsByTagName('tr');

    for (var i = 1; i < rows.length; i++) {
        var cells = rows[i].getElementsByTagName('td');
        var currentSet = parseInt(cells[0].textContent);
        var reps = parseInt(cells[1].querySelector('input').value);
        var weight = parseInt(cells[2].querySelector('input').value);

        var data = {
            "workoutName": workoutName,
            "currentSet": currentSet,
            "reps": reps,
            "weight": weight
        };

        console.log(JSON.stringify(data));

        postData("/workouts/create", data)
            .then(response => {
                console.log("Workout created successfully:", response);
            })
            .catch(error => {
                console.error("Error creating workout:", error);
            });
    }

<!--        // Sending data to the server using AJAX-->
<!--        var xhr = new XMLHttpRequest();-->
<!--        xhr.open("POST", "/workouts/create", true);-->
<!--        xhr.setRequestHeader("Content-Type", "application/json");-->
<!--        xhr.onreadystatechange = function () {-->
<!--            if (xhr.readyState === 4 && xhr.status === 200) {-->
<!--                console.log(xhr.responseText);-->
<!--            }-->
<!--        };-->
<!--        xhr.send(JSON.stringify(data));-->
    }




</script>
</body>
</html>
